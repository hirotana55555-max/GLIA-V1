"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SwarmError = exports.ScoreCardSchema = exports.CritiqueSchema = exports.ProposalSchema = exports.MissionSchema = exports.InstructionSchema = exports.TimestampSchema = exports.AgentIdSchema = void 0;
exports.buildProposal = buildProposal;
const zod_1 = require("zod");
/**
 * Common primitive types
 */
exports.AgentIdSchema = zod_1.z.string().describe("UUID or identifier of the agent");
exports.TimestampSchema = zod_1.z.string().datetime().describe("ISO 8601 timestamp");
/**
 * Instruction Schema (SIE)
 */
exports.InstructionSchema = zod_1.z.object({
    action: zod_1.z.enum(["navigate", "click", "input", "extract", "noop"]),
    target: zod_1.z.string().optional(),
    value: zod_1.z.string().nullable().optional(),
    options: zod_1.z.record(zod_1.z.any()).optional(),
    meta: zod_1.z.record(zod_1.z.any()).optional(),
});
/**
 * 1. Mission (The Quest)
 * The initial instruction provided by the Human (Quest Giver).
 */
exports.MissionSchema = zod_1.z.object({
    id: zod_1.z.string().uuid(),
    title: zod_1.z.string(),
    description: zod_1.z.string().describe("Detailed description of the task"),
    evaluation_prompt: zod_1.z.string().describe("The criteria by which the solution will be judged. Dynamic Evaluation Criteria."),
    created_at: exports.TimestampSchema,
    created_by: zod_1.z.string().default("human"),
});
/**
 * 2. Proposal (The Solution)
 * Generated by an Executor Agent.
 */
exports.ProposalSchema = zod_1.z.object({
    id: zod_1.z.string().uuid(),
    mission_id: zod_1.z.string().uuid(),
    author_id: exports.AgentIdSchema,
    content: zod_1.z.string().describe("The proposed solution (code, text, plan, etc.)"),
    reasoning: zod_1.z.string().optional().describe("Explanation of why this solution was chosen"),
    instructions: zod_1.z.array(exports.InstructionSchema).optional().describe("Structured Instructions generated by agent for SIE execution"),
    metadata: zod_1.z.record(zod_1.z.any()).optional().describe("Agent metadata / Swarm meta"),
    created_at: exports.TimestampSchema,
});
/**
 * 3. Critique (The Review)
 * Generated by a Reviewer Agent (Peer Review).
 */
exports.CritiqueSchema = zod_1.z.object({
    id: zod_1.z.string().uuid(),
    proposal_id: zod_1.z.string().uuid(),
    reviewer_id: exports.AgentIdSchema,
    feedback: zod_1.z.string().describe("Detailed feedback on the proposal based on the Mission's evaluation_prompt"),
    score: zod_1.z.number().min(0).max(100).describe("Numerical score (0-100)"),
    created_at: exports.TimestampSchema,
});
/**
 * 4. ScoreCard (The Verdict)
 * Automated aggregation or final decision.
 * In a pure swarm, this might be calculated from multiple Critiques.
 */
exports.ScoreCardSchema = zod_1.z.object({
    proposal_id: zod_1.z.string().uuid(),
    mission_id: zod_1.z.string().uuid(),
    average_score: zod_1.z.number(),
    critique_count: zod_1.z.number(),
    status: zod_1.z.enum(["ACCEPTED", "REJECTED", "NEEDS_REVISION"]),
    final_comment: zod_1.z.string().optional(),
});
/**
 * Helper to build a Proposal from high-level mission + instruction list
 */
function buildProposal(missionId, content, instructions = [], metadata = {}) {
    return {
        mission_id: missionId,
        content,
        instructions,
        metadata
    };
}
class SwarmError extends Error {
    constructor(code, message, metadata) {
        super(message);
        this.code = code;
        this.metadata = metadata;
        this.name = "SwarmError";
    }
}
exports.SwarmError = SwarmError;
